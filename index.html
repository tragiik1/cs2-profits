<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CS2P&L</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50' y='50' font-size='70' fill='white' text-anchor='middle' dominant-baseline='middle' font-family='Arial,sans-serif' font-weight='bold'>$</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.bunny.net/css?family=montserrat:600,700" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  </head>
  <body>
    <div id="app">
      <header class="topbar">
        <div class="brand">
          <div class="title">CS2P&L</div>
        </div>
        <div class="actions">
          <button id="open-search-btn" class="ghost icon-btn" title="Search CS2 Items (Ctrl+K)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </button>
          <button id="sign-in-btn" class="ghost">Sign In</button>
          <select id="display-currency" title="Display Currency"></select>
          <button id="open-menu" class="ghost icon-btn" title="Menu">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
        </div>
      </header>

      <main class="main-content">
        <!-- Main Net Profit/Loss Display -->
        <section class="hero-section">
          <div class="net-profit-display" id="stat-net-card">
            <div class="net-label">Net Profit / Loss</div>
            <div class="net-value" id="stat-net">—</div>
            <div class="net-actions">
              <button id="add-transaction-btn" class="primary large-btn">Add</button>
            </div>
          </div>
        </section>

        <!-- Analytics Section -->
        <section class="analytics-section">
          <button class="section-toggle" id="analytics-toggle">
            <span>Analytics</span>
            <svg class="toggle-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="analytics-content" id="analytics-content">
            <div class="analytics-grid">
              <div class="analytics-card">
                <div class="analytics-label">Total Spent</div>
                <div class="analytics-value" id="stat-spent">—</div>
              </div>
              <div class="analytics-card">
                <div class="analytics-label">Profit %</div>
                <div class="analytics-value" id="stat-profit-pct">—</div>
              </div>
            </div>
            <div class="chart-card">
              <div class="chart-header">
                <h3>Profit / Loss Over Time</h3>
                <div class="chart-periods">
                  <button class="period-btn" data-period="24h">24h</button>
                  <button class="period-btn" data-period="week">Week</button>
                  <button class="period-btn active" data-period="month">Month</button>
                  <button class="period-btn" data-period="lifetime">Lifetime</button>
                </div>
              </div>
              <div class="chart-wrapper">
                <canvas id="profit-chart"></canvas>
              </div>
            </div>
          </div>
        </section>

        <!-- Inventory Section (only shown when signed in) -->
        <section class="inventory-section" id="inventory-section" style="display: none;">
          <div class="section-header">
            <h2>CS2 Inventory</h2>
            <div class="section-header-actions">
              <button id="inventory-filter-btn" class="ghost" title="Filter Inventory">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
                Filter
              </button>
              <button id="refresh-inventory-btn" class="ghost">Refresh</button>
            </div>
          </div>
          <div class="inventory-filters" id="inventory-filters" style="display: none;">
            <div class="filter-group">
              <label>Type</label>
              <select id="inventory-filter-type">
                <option value="">All Types</option>
                <option value="Weapon">Weapon</option>
                <option value="Container">Container</option>
                <option value="Sticker">Sticker</option>
                <option value="Graffiti">Graffiti</option>
                <option value="Music Kit">Music Kit</option>
                <option value="Key">Key</option>
              </select>
            </div>
            <div class="filter-group">
              <label>Price Range</label>
              <div class="price-range-inputs">
                <input type="number" id="inventory-filter-price-min" placeholder="Min" step="0.01" min="0" />
                <span>to</span>
                <input type="number" id="inventory-filter-price-max" placeholder="Max" step="0.01" min="0" />
              </div>
            </div>
            <button id="inventory-filter-apply" class="primary">Apply</button>
            <button id="inventory-filter-clear" class="ghost">Clear</button>
          </div>
          <div class="inventory-grid" id="inventory-grid">
            <div class="inventory-loading">Loading inventory...</div>
          </div>
        </section>

        <!-- History Section -->
        <section class="history-section">
          <div class="section-header">
            <h2>History</h2>
            <div class="section-header-actions">
              <button id="transaction-filter-btn" class="ghost" title="Filter Transactions">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
                Filter
              </button>
              <button id="bulk-actions-btn" class="ghost" title="Bulk Actions" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="9" y1="3" x2="9" y2="21"></line>
                </svg>
                Bulk Actions
              </button>
              <input id="search" type="text" placeholder="Search items/notes" class="search-input" />
            </div>
          </div>
          <div class="transaction-filters" id="transaction-filters" style="display: none;">
            <div class="filter-group">
              <label>Date Range</label>
              <div class="date-range-inputs">
                <input type="date" id="transaction-filter-date-from" />
                <span>to</span>
                <input type="date" id="transaction-filter-date-to" />
              </div>
            </div>
            <div class="filter-group">
              <label>Type</label>
              <select id="transaction-filter-type">
                <option value="">All Types</option>
                <option value="Case">Case</option>
                <option value="Trade">Trade</option>
                <option value="Trade-up">Trade-up</option>
              </select>
            </div>
            <div class="filter-group">
              <label>Profit Range</label>
              <div class="price-range-inputs">
                <input type="number" id="transaction-filter-profit-min" placeholder="Min" step="0.01" />
                <span>to</span>
                <input type="number" id="transaction-filter-profit-max" placeholder="Max" step="0.01" />
              </div>
            </div>
            <button id="transaction-filter-apply" class="primary">Apply</button>
            <button id="transaction-filter-clear" class="ghost">Clear</button>
          </div>
          <div class="bulk-actions-bar" id="bulk-actions-bar" style="display: none;">
            <span id="bulk-selected-count">0 selected</span>
            <div class="bulk-actions-buttons">
              <button id="bulk-delete-btn" class="ghost danger">Delete</button>
              <button id="bulk-close-btn" class="ghost">Close</button>
            </div>
          </div>
          <div class="table-wrapper">
            <table id="tx-table">
              <thead>
                <tr>
                  <th style="width: 40px;">
                    <input type="checkbox" id="select-all-checkbox" title="Select All" />
                  </th>
                  <th>Date</th>
                  <th>Item Name</th>
                  <th>Type</th>
                  <th>Qty</th>
                  <th>Buy Price</th>
                  <th>Sell Price</th>
                  <th>Profit / Loss</th>
                  <th>Profit %</th>
                  <th>Notes</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="tx-tbody"></tbody>
            </table>
          </div>
        </section>
      </main>

      <!-- Menu Modal -->
      <dialog id="menu-modal">
        <form method="dialog" class="menu-dialog">
          <h3>Menu</h3>
          <div class="menu-actions">
            <button id="menu-settings" type="button" class="menu-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path>
              </svg>
              Settings
            </button>
            <button id="menu-import" type="button" class="menu-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Import
            </button>
            <button id="menu-export" type="button" class="menu-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              Export
            </button>
          </div>
          <menu class="dialog-actions">
            <button value="cancel" class="ghost">Close</button>
          </menu>
        </form>
      </dialog>

      <!-- Add Transaction Modal -->
      <dialog id="add-transaction-modal">
        <form method="dialog" id="tx-form" class="transaction-form" autocomplete="off">
          <h3>Add Transaction</h3>
          <div class="form-grid">
            <div class="field">
              <label for="tx-date">Date</label>
              <input id="tx-date" type="date" required />
            </div>
            <div class="field">
              <label for="tx-type">Type</label>
              <select id="tx-type" required>
                <option value="Case">Case</option>
                <option value="Trade">Trade</option>
                <option value="Trade-up">Trade-up</option>
              </select>
            </div>
            <div class="field">
              <label for="tx-item">Item Name</label>
              <input id="tx-item" type="text" placeholder="e.g. Kilowatt Case" autocomplete="off" required />
            </div>
            <div class="field">
              <label for="tx-quantity">Quantity</label>
              <input id="tx-quantity" type="number" step="1" min="1" value="1" required />
            </div>
            <div class="field">
              <label for="tx-buy">Buy Price (per item)</label>
              <input id="tx-buy" type="number" step="0.01" min="0" required />
            </div>
            <div class="field">
              <label for="tx-sell">Sell Price (per item)</label>
              <input id="tx-sell" type="number" step="0.01" min="0" />
            </div>
            <div class="field">
              <label for="tx-notes">Notes</label>
              <input id="tx-notes" type="text" placeholder="Optional" />
            </div>
            <div class="field">
              <label for="tx-currency">Currency</label>
              <select id="tx-currency"></select>
            </div>
          </div>
          <menu class="dialog-actions">
            <button type="button" class="ghost" onclick="document.getElementById('add-transaction-modal').close()">Close</button>
            <button type="submit" class="primary">Add Transaction</button>
          </menu>
        </form>
      </dialog>

      <!-- Settings Modal -->
      <dialog id="settings-modal">
        <form method="dialog" class="settings">
          <h3>Settings</h3>
          <div class="field">
            <label for="base-currency">Account Base Currency</label>
            <select id="base-currency"></select>
          </div>
          <div class="rates">
            <div class="rates-header">
              <div>
                <strong>Exchange Rates</strong>
                <span class="muted">Relative to base currency</span>
              </div>
              <button id="refresh-rates" class="ghost" type="button">Refresh</button>
            </div>
            <div id="rates-list" class="rates-list"></div>
            <p class="muted">If live fetch fails, you can edit rates manually.</p>
          </div>
          <menu class="dialog-actions">
            <button value="cancel" class="ghost">Close</button>
            <button id="save-settings" value="default" class="primary">Save</button>
          </menu>
        </form>
      </dialog>

      <!-- Export Modal -->
      <dialog id="export-modal">
        <form method="dialog" class="settings">
          <h3>Export Data</h3>
          <div class="export-buttons">
            <button id="export-json-btn" type="button" class="primary export-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              JSON
            </button>
            <button id="export-excel-btn" type="button" class="primary export-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              Excel
            </button>
          </div>
          <menu class="dialog-actions">
            <button value="cancel" class="ghost">Close</button>
          </menu>
        </form>
      </dialog>

      <!-- Import Modal -->
      <dialog id="import-modal">
        <form method="dialog" class="settings">
          <h3>Import Data</h3>
          <div class="import-buttons">
            <label class="file-btn primary import-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              JSON
              <input id="import-json" type="file" accept="application/json,.json" hidden />
            </label>
            <label class="file-btn primary import-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Excel
              <input id="import-excel" type="file" accept=".xlsx,.xls" hidden />
            </label>
          </div>
          <menu class="dialog-actions">
            <button value="cancel" class="ghost">Close</button>
          </menu>
        </form>
      </dialog>

      <!-- CSFloat-style Search Overlay -->
      <div id="search-overlay" class="search-overlay" style="display: none;">
        <div class="search-overlay-content">
          <div class="search-overlay-header">
            <input 
              type="text" 
              id="search-overlay-input" 
              class="search-overlay-input" 
              placeholder="Search CS2 items (skins, stickers, cases, etc.)..."
              autocomplete="off"
            />
            <button id="search-overlay-close" class="search-overlay-close">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div id="search-overlay-results" class="search-overlay-results">
            <div class="search-overlay-empty">Start typing to search for CS2 items...</div>
          </div>
        </div>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
</html>
